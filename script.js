const QUOTES = [
  {
    t: "He so√±ado en mi vida sue√±os que han permanecido conmigo para siempre, y han cambiado mis ideas; han pasado a trav√©s de m√≠ como el vino a trav√©s del agua, y han alterado el color de mi mente. Si me caso con Linton, podr√≠a ser muy feliz: √©l es tan apacible, y tan diferente de Heathcliff. Pero ¬øc√≥mo puedo vivir sin mi alma? Yo s√© que Heathcliff no sabe cu√°nto lo amo, ni que no es porque sea guapo, Nelly, sino porque es m√°s yo que yo misma. Sea lo que sea de lo que est√©n hechas nuestras almas, la suya y la m√≠a son lo mismo, y Linton es tan diferente de m√≠ como un rayo de luna de un rel√°mpago, o el hielo del fuego. Mi amor por Linton es como el follaje del bosque: el tiempo lo cambiar√°, lo s√© bien, como el invierno cambia los √°rboles. Mi amor por Heathcliff se parece a las rocas eternas que hay debajo: no es una fuente de placer visible, pero es necesario. Nelly, yo soy Heathcliff. √âl est√° siempre, siempre en mi mente: no como un placer, sino como mi propio ser. As√≠ que no hables de separarnos; eso es imposible.",
    a: "üïØÔ∏è Catherine Earnshaw, Cap√≠tulo IX. Cumbres Borrascosas."
  },
  {
    t: "‚Äî¬°D√©jame ir, Heathcliff! ‚Äîdijo ella‚Äî. Si me matas, mi alma no descansar√°. Estar√© a tu alrededor, en los p√°ramos, de noche y de d√≠a. Me asomar√© por tu ventana en cada viento; me reir√© de ti, y no podr√°s escapar de m√≠ hasta que te mueras. ¬øTe crees que porque odio el alma que me separ√≥ de ti, no te amo a ti? ¬°Tonto, tonto Heathcliff! ¬°Oh, te amo, te amo! ¬øPor qu√© no puedo odiarte? Me has roto el coraz√≥n, y t√∫ rompes el tuyo al mismo tiempo; y eso es suficiente para ambos.",
    a: "Catherine Earnshaw. Cumbres Borrascosas."
  },
  {
    t: "No s√© c√≥mo logr√© abrir el ata√∫d; no me importaba si me descubr√≠an, si me maldec√≠an o si me condenaban. La mir√©: ¬°ay, Dios m√≠o! Su rostro hab√≠a perdido la expresi√≥n, pero segu√≠a siendo ella. Mis l√°grimas no eran de dolor, sino de furia. La abrac√© con desesperaci√≥n y la bes√© con la rabia de un loco. ‚Äî¬°Catherine Earnshaw! ‚Äîgrit√©‚Äî, que regreses a m√≠ como alma o como sombra, pero regresa. Pers√≠gueme, tort√∫rame, hazme perder la raz√≥n, pero no te apartes de mi lado. ¬°No puedo vivir sin mi vida! ¬°No puedo vivir sin mi alma!‚Äù",
    a: "Heathcliff. Cumbres Borrascosas"
  },
  {
    t: "He estado vagando por los p√°ramos noche y d√≠a desde que ella muri√≥. No puedo dormir, no puedo comer. La odio por dejarme; pero la amo con una pasi√≥n que no muere. No puedo dejar de odiar lo que destruy√≥ mi alma. ¬°Oh, si pudiera olvidarla! Pero cada pensamiento, cada visi√≥n, cada respiraci√≥n me la devuelve. A veces me parece que la veo en los pliegues de la niebla, o en la forma de una nube, o que la oigo riendo en el viento. No quiero seguir viviendo. Estoy cansado de seguir respirando cuando ella no est√° aqu√≠. No quiero suplantar a los vivos, quiero estar con los muertos. Tal vez la muerte me devuelva lo que la vida me quit√≥.",
    a: "Heathcliff. Cumbres Borrascosas"
  },
  {
    t: "Estaba tendido en la cama, con los ojos abiertos y una sonrisa extra√±a en los labios, como si hubiera conseguido por fin lo que tanto hab√≠a deseado. La ventana estaba abierta, el viento agitaba el cabello sobre su frente, y la lluvia hab√≠a empapado la almohada. Su rostro, aunque p√°lido, ten√≠a una serenidad que jam√°s vi en √©l en vida. No sent√≠ miedo, sino una especie de respeto solemne. Era como si el esp√≠ritu de Catherine hubiera venido a buscarlo, y ahora ambos descansaran juntos, al fin.",
    a: "Nelly Dean. Cumbres Borrascosas"
  },
  {
    t: "Cielos, qu√© tierra salvaje, triste y hermosa es √©sta ‚Äîpens√© al aproximarme al edificio‚Äî. El aire soplaba con tanta fuerza que apenas pod√≠a mantenerme en pie, y los p√°ramos se extend√≠an a mi alrededor como un mar oscuro y sin l√≠mites. Sin embargo, hab√≠a algo en ese aislamiento, en esa rudeza, que me atra√≠a irresistiblemente. Era un paisaje que hablaba de pasiones primitivas y tormentas interiores.",
    a: "Lockwood. Cumbres Borrascosas"
  },
  {
    t: "Fue una noche espantosa aquella en que cobr√© vida. Un fr√≠o helado me recorri√≥; una luz deslumbrante hiri√≥ mis ojos, y un ruido confuso me ensordeci√≥. Poco a poco distingu√≠ las formas que me rodeaban, y una sensaci√≥n de calor, de hambre, de cansancio me abrum√≥. No sab√≠a qui√©n era ni qu√© era. Vagaba por los bosques sin rumbo, estremecido por la lluvia y el viento, con los sentidos confusos pero llenos de una curiosidad inexplicable. Aprend√≠ que el fuego daba calor y luz, pero tambi√©n que quemaba; y que el agua calmaba la sed, pero pod√≠a ahogar. As√≠, paso a paso, fui descubriendo el mundo.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "Observaba a la familia y aprend√≠a de ellos. Me maravillaba la suavidad de sus costumbres, el amor que se profesaban y la armon√≠a de su hogar. Al principio ignoraba las palabras que pronunciaban, pero poco a poco fui comprendiendo que exist√≠a un modo de comunicaci√≥n m√°s elevado que los gestos. Me esforc√© por imitar sus sonidos, y con el tiempo logr√© entenderlos. As√≠, en mi coraz√≥n nacieron emociones desconocidas: admiraci√≥n, ternura, deseo de afecto. Comprend√≠ que ellos se amaban mutuamente, y que yo no ten√≠a a nadie. Cada d√≠a que pasaba aumentaba mi conocimiento y mi desesperanza.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "Un d√≠a, mientras contemplaba mi reflejo en un estanque, me sobrecogi√≥ el espanto. No pod√≠a creer que aquel rostro deformado y espantoso me perteneciera. Cuando ve√≠a a los dem√°s hombres, tan bellos y armoniosos, sent√≠a que entre ellos yo no ten√≠a lugar. La desesperaci√≥n me invadi√≥. ¬°Oh, cu√°nto hubiera dado por borrar esa fealdad, por tener un amigo que no huyera al verme! Pero comprend√≠ que mi destino era la soledad.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "¬°Cr√©ame una compa√±era, igual que yo, con la que pueda vivir en la mutua comprensi√≥n! Exijo este derecho, que no se me niegue por compasi√≥n o por justicia. He sido bueno; he sufrido; he sido abandonado. La soledad me consume. Recuerde que soy su obra: usted me debe felicidad, o al menos la ausencia del tormento. Si concede mi petici√≥n, me alejar√© para siempre de los hombres, y usted no volver√° a saber de m√≠.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "√âl est√° muerto, y yo tambi√©n lo estar√© pronto. Pero antes de irme quiero que sepa que no era mi deseo hacer el mal. Todo empez√≥ con el abandono. Quer√≠a amor y recib√≠ odio. Quer√≠a compa√±√≠a y recib√≠ soledad. Si los hombres hubieran sido justos conmigo, habr√≠a sido su amigo; pero el sufrimiento convirti√≥ mi coraz√≥n en hiel. Aun as√≠, no puedo odiar a quien me dio la vida; he sentido dolor por su muerte. No me queda m√°s que desaparecer entre los hielos, donde el fuego de mis remordimientos se extinguir√° para siempre.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "Isa, cuando leas estas p√°ginas, yo habr√© muerto. He querido hablarte al fin sin odio, sin deseo de herirte, sin esa c√≥lera fr√≠a que ha guiado toda mi vida.\nDurante cuarenta a√±os he vivido junto a ti como un enemigo, y cada d√≠a he buscado nuevas razones para justificar mi odio. Pero lo cierto es que te odi√© porque te am√©, porque esperaba de ti lo que t√∫ no sab√≠as darme. Te reproch√© haberme cerrado las puertas de tu alma, cuando en realidad era yo quien las hab√≠a cerrado primero.",
    a: "Louis, Nudo de v√≠boras"
  }
  { "t": "Siento como si me hubiesen robado algo esencial y no s√© qu√© es.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Soy del tama√±o de lo que veo, no del tama√±o de mi estatura.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Todo me cansa, hasta aquello que no me cansa.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "No soy nada. Nunca ser√© nada. No puedo querer ser nada. Aparte de eso, tengo en m√≠ todos los sue√±os del mundo.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "La tristeza es un h√°bito que se me ha hecho carne.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Vivir es ser otro. Ni sentir es posible si hoy se siente como ayer se sinti√≥.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "La vida es lo que hacemos de ella. Los viajes son los viajeros. Lo que vemos no es lo que vemos, sino lo que somos.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Sue√±o porque no puedo vivir.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Tengo, en efecto, el alma de una marioneta filos√≥fica.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Nada me une a nada. Quiero veinte cosas al mismo tiempo y no deseo ninguna.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Mi alma es como una orquesta oculta; no s√© qu√© instrumentos tocan ni qu√© m√∫sica producen.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Soy como una habitaci√≥n con muchos espejos que se reflejan en espejos; en cada uno me veo diferente, y la imagen de todos esos reflejos soy yo.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "He llegado a un punto donde ya no me interesa ser comprendido: me basta con ser.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Todo esfuerzo es un error; toda acci√≥n es una derrota.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "No pertenezco a nada. Ni siquiera a la indiferencia a la que pertenezco.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Mi deseo es huir, pero no s√© de qu√©; mi deseo es buscar, pero no s√© qu√©.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Sufro de una lucidez que me impide ser contento.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "A veces siento un cansancio tan profundo que no tengo ni siquiera ganas de so√±ar.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Hay un cansancio del alma m√°s terrible que el del cuerpo: el cansancio de no querer nada.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "La monoton√≠a del ser es un mar sin olas.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "El tedio es la sensaci√≥n f√≠sica del tiempo que pasa lentamente.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Lo que en m√≠ siente est√° pensando.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "El insomnio de mi alma tiene los ojos abiertos y ve siempre lo mismo.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "No s√© qui√©n soy: no s√© qu√© alma tengo.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Soy un paisaje de dentro.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "La lucidez me devora como una llama interior.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "La soledad no es estar solo, es estar vac√≠o.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "Hay momentos en que todo me parece un decorado; incluso yo.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "La vida es una posada en la que debo esperar hasta que me llamen del abismo.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" },
  { "t": "No me duele la vida; me duele la conciencia de vivir.", "a": "Fernando Pessoa (Bernardo Soares)", "obra": "El libro del desasosiego", "lang": "es" }
];

const STORAGE_KEY = "paramo-literario-vistos";

function getVistos() {
  try {
    const arr = JSON.parse(localStorage.getItem(STORAGE_KEY));
    return Array.isArray(arr) ? arr : [];
  } catch { return []; }
}

function setVistos(arr) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

function pickRandomNoRepeat() {
  let vistos = getVistos();
  if (vistos.length >= QUOTES.length) {
    vistos = [];
  }
  const disponibles = QUOTES.map((_, i) => i).filter(i => !vistos.includes(i));
  const elegido = disponibles[Math.floor(Math.random() * disponibles.length)];
  vistos.push(elegido);
  setVistos(vistos);
  return { ...QUOTES[elegido], idx: elegido };
}

let currentQuote = null;
let voicesReady = false;

// Selecciona la voz m√°s fluida disponible
function getPreferredVoice() {
  const voices = window.speechSynthesis.getVoices();
  return (
    voices.find(v => v.lang.startsWith("es") && v.name.includes("Google")) ||
    voices.find(v => v.lang.startsWith("es") && v.name.includes("Microsoft Sabina")) ||
    voices.find(v => v.lang.startsWith("es"))
  );
}

function speakQuote(text) {
  if (!voicesReady) {
    setTimeout(() => speakQuote(text), 200);
    return;
  }
  if (window.speechSynthesis.speaking) {
    window.speechSynthesis.cancel();
  }
  const utter = new window.SpeechSynthesisUtterance(text);
  const preferred = getPreferredVoice();
  if (preferred) {
    utter.voice = preferred;
    utter.lang = preferred.lang;
  } else {
    utter.lang = "es-ES";
  }
  window.speechSynthesis.speak(utter);
}

function renderQuote() {
  currentQuote = pickRandomNoRepeat();
  document.getElementById('quote').textContent = '‚Äú' + currentQuote.t + '‚Äù';
  document.getElementById('author').textContent = '‚Äî ' + currentQuote.a;
}

function initApp() {
  renderQuote();
  const card = document.getElementById("card");
  if (card) {
    card.addEventListener("click", () => {
      if (currentQuote) {
        speakQuote(`${currentQuote.t}. ${currentQuote.a}`);
      }
    });
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        if (currentQuote) {
          speakQuote(`${currentQuote.t}. ${currentQuote.a}`);
        }
      }
    });
  }
}

// Espera a que las voces est√©n listas antes de permitir hablar
window.speechSynthesis.onvoiceschanged = () => {
  voicesReady = true;
};

document.addEventListener("DOMContentLoaded", () => {
  if (window.speechSynthesis.getVoices().length > 0) {
    voicesReady = true;
  }
  initApp();
});
