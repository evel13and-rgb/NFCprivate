import { createQuoteManager } from './quoteLogic.js';

const QUOTES = [
  {
    t: "He so√±ado en mi vida sue√±os que han permanecido conmigo para siempre, y han cambiado mis ideas; han pasado a trav√©s de m√≠ como el vino a trav√©s del agua, y han alterado el color de mi mente. Si me caso con Linton, podr√≠a ser muy feliz: √©l es tan apacible, y tan diferente de Heathcliff. Pero ¬øc√≥mo puedo vivir sin mi alma? Yo s√© que Heathcliff no sabe cu√°nto lo amo, ni que no es porque sea guapo, Nelly, sino porque es m√°s yo que yo misma. Sea lo que sea de lo que est√©n hechas nuestras almas, la suya y la m√≠a son lo mismo, y Linton es tan diferente de m√≠ como un rayo de luna de un rel√°mpago, o el hielo del fuego. Mi amor por Linton es como el follaje del bosque: el tiempo lo cambiar√°, lo s√© bien, como el invierno cambia los √°rboles. Mi amor por Heathcliff se parece a las rocas eternas que hay debajo: no es una fuente de placer visible, pero es necesario. Nelly, yo soy Heathcliff. √âl est√° siempre, siempre en mi mente: no como un placer, sino como mi propio ser. As√≠ que no hables de separarnos; eso es imposible.",
    a: "üïØÔ∏è Catherine Earnshaw, Cap√≠tulo IX. Cumbres Borrascosas."
  },
  {
    t: "‚Äî¬°D√©jame ir, Heathcliff! ‚Äîdijo ella‚Äî. Si me matas, mi alma no descansar√°. Estar√© a tu alrededor, en los p√°ramos, de noche y de d√≠a. Me asomar√© por tu ventana en cada viento; me reir√© de ti, y no podr√°s escapar de m√≠ hasta que te mueras. ¬øTe crees que porque odio el alma que me separ√≥ de ti, no te amo a ti? ¬°Tonto, tonto Heathcliff! ¬°Oh, te amo, te amo! ¬øPor qu√© no puedo odiarte? Me has roto el coraz√≥n, y t√∫ rompes el tuyo al mismo tiempo; y eso es suficiente para ambos.",
    a: "Catherine Earnshaw. Cumbres Borrascosas."
  },
  {
    t: "No s√© c√≥mo logr√© abrir el ata√∫d; no me importaba si me descubr√≠an, si me maldec√≠an o si me condenaban. La mir√©: ¬°ay, Dios m√≠o! Su rostro hab√≠a perdido la expresi√≥n, pero segu√≠a siendo ella. Mis l√°grimas no eran de dolor, sino de furia. La abrac√© con desesperaci√≥n y la bes√© con la rabia de un loco. ‚Äî¬°Catherine Earnshaw! ‚Äîgrit√©‚Äî, que regreses a m√≠ como alma o como sombra, pero regresa. Pers√≠gueme, tort√∫rame, hazme perder la raz√≥n, pero no te apartes de mi lado. ¬°No puedo vivir sin mi vida! ¬°No puedo vivir sin mi alma!‚Äù",
    a: "Heathcliff. Cumbres Borrascosas"
  },
  {
    t: "He estado vagando por los p√°ramos noche y d√≠a desde que ella muri√≥. No puedo dormir, no puedo comer. La odio por dejarme; pero la amo con una pasi√≥n que no muere. No puedo dejar de odiar lo que destruy√≥ mi alma. ¬°Oh, si pudiera olvidarla! Pero cada pensamiento, cada visi√≥n, cada respiraci√≥n me la devuelve. A veces me parece que la veo en los pliegues de la niebla, o en la forma de una nube, o que la oigo riendo en el viento. No quiero seguir viviendo. Estoy cansado de seguir respirando cuando ella no est√° aqu√≠. No quiero suplantar a los vivos, quiero estar con los muertos. Tal vez la muerte me devuelva lo que la vida me quit√≥.",
    a: "Heathcliff. Cumbres Borrascosas"
  },
  {
    t: "Estaba tendido en la cama, con los ojos abiertos y una sonrisa extra√±a en los labios, como si hubiera conseguido por fin lo que tanto hab√≠a deseado. La ventana estaba abierta, el viento agitaba el cabello sobre su frente, y la lluvia hab√≠a empapado la almohada. Su rostro, aunque p√°lido, ten√≠a una serenidad que jam√°s vi en √©l en vida. No sent√≠ miedo, sino una especie de respeto solemne. Era como si el esp√≠ritu de Catherine hubiera venido a buscarlo, y ahora ambos descansaran juntos, al fin.",
    a: "Nelly Dean. Cumbres Borrascosas"
  },
  {
    t: "Cielos, qu√© tierra salvaje, triste y hermosa es √©sta ‚Äîpens√© al aproximarme al edificio‚Äî. El aire soplaba con tanta fuerza que apenas pod√≠a mantenerme en pie, y los p√°ramos se extend√≠an a mi alrededor como un mar oscuro y sin l√≠mites. Sin embargo, hab√≠a algo en ese aislamiento, en esa rudeza, que me atra√≠a irresistiblemente. Era un paisaje que hablaba de pasiones primitivas y tormentas interiores.",
    a: "Lockwood. Cumbres Borrascosas"
  },
  {
    t: "Fue una noche espantosa aquella en que cobr√© vida. Un fr√≠o helado me recorri√≥; una luz deslumbrante hiri√≥ mis ojos, y un ruido confuso me ensordeci√≥. Poco a poco distingu√≠ las formas que me rodeaban, y una sensaci√≥n de calor, de hambre, de cansancio me abrum√≥. No sab√≠a qui√©n era ni qu√© era. Vagaba por los bosques sin rumbo, estremecido por la lluvia y el viento, con los sentidos confusos pero llenos de una curiosidad inexplicable. Aprend√≠ que el fuego daba calor y luz, pero tambi√©n que quemaba; y que el agua calmaba la sed, pero pod√≠a ahogar. As√≠, paso a paso, fui descubriendo el mundo.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "Observaba a la familia y aprend√≠a de ellos. Me maravillaba la suavidad de sus costumbres, el amor que se profesaban y la armon√≠a de su hogar. Al principio ignoraba las palabras que pronunciaban, pero poco a poco fui comprendiendo que exist√≠a un modo de comunicaci√≥n m√°s elevado que los gestos. Me esforc√© por imitar sus sonidos, y con el tiempo logr√© entenderlos. As√≠, en mi coraz√≥n nacieron emociones desconocidas: admiraci√≥n, ternura, deseo de afecto. Comprend√≠ que ellos se amaban mutuamente, y que yo no ten√≠a a nadie. Cada d√≠a que pasaba aumentaba mi conocimiento y mi desesperanza.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "Un d√≠a, mientras contemplaba mi reflejo en un estanque, me sobrecogi√≥ el espanto. No pod√≠a creer que aquel rostro deformado y espantoso me perteneciera. Cuando ve√≠a a los dem√°s hombres, tan bellos y armoniosos, sent√≠a que entre ellos yo no ten√≠a lugar. La desesperaci√≥n me invadi√≥. ¬°Oh, cu√°nto hubiera dado por borrar esa fealdad, por tener un amigo que no huyera al verme! Pero comprend√≠ que mi destino era la soledad.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "¬°Cr√©ame una compa√±era, igual que yo, con la que pueda vivir en la mutua comprensi√≥n! Exijo este derecho, que no se me niegue por compasi√≥n o por justicia. He sido bueno; he sufrido; he sido abandonado. La soledad me consume. Recuerde que soy su obra: usted me debe felicidad, o al menos la ausencia del tormento. Si concede mi petici√≥n, me alejar√© para siempre de los hombres, y usted no volver√° a saber de m√≠.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "√âl est√° muerto, y yo tambi√©n lo estar√© pronto. Pero antes de irme quiero que sepa que no era mi deseo hacer el mal. Todo empez√≥ con el abandono. Quer√≠a amor y recib√≠ odio. Quer√≠a compa√±√≠a y recib√≠ soledad. Si los hombres hubieran sido justos conmigo, habr√≠a sido su amigo; pero el sufrimiento convirti√≥ mi coraz√≥n en hiel. Aun as√≠, no puedo odiar a quien me dio la vida; he sentido dolor por su muerte. No me queda m√°s que desaparecer entre los hielos, donde el fuego de mis remordimientos se extinguir√° para siempre.",
    a: "La Criatura. Frankenstein o El moderno Prometeo"
  },
  {
    t: "Isa, cuando leas estas p√°ginas, yo habr√© muerto. He querido hablarte al fin sin odio, sin deseo de herirte, sin esa c√≥lera fr√≠a que ha guiado toda mi vida.\nDurante cuarenta a√±os he vivido junto a ti como un enemigo, y cada d√≠a he buscado nuevas razones para justificar mi odio. Pero lo cierto es que te odi√© porque te am√©, porque esperaba de ti lo que t√∫ no sab√≠as darme. Te reproch√© haberme cerrado las puertas de tu alma, cuando en realidad era yo quien las hab√≠a cerrado primero.",
    a: "Louis, Nudo de v√≠boras"
  },
  {
    t: "Vine a Comala porque me dijeron que ac√° viv√≠a mi padre, un tal Pedro P√°ramo. Mi madre me lo dijo. Y yo le promet√≠ que vendr√≠a a verlo en cuanto ella muriera. Le apret√© las manos en se√±al de que lo har√≠a; pues ella estaba por morirse y yo en un plan de prometerlo todo.",
    a: "Juan Preciado. Pedro P√°ramo"
  },
  {
    t: "La tierra est√° llena de memorias. Oyen nuestros pasos y responden con ecos viejos, con voces que cre√≠amos perdidas. Basta cerrar los ojos para sentir el temblor de los muertos, la respiraci√≥n de quienes alguna vez amamos.",
    a: "Susurros del p√°ramo. Pedro P√°ramo"
  },
  {
    t: "Se oye el rumor de la lluvia como si la noche estuviera llena de almas. Cada gota golpea con un dolor antiguo, como si el cielo llorara por nosotros. Y sin embargo, hay una paz en esa tristeza, una tregua que nos deja respirar.",
    a: "Susana San Juan. Pedro P√°ramo"
  },
  {
    t: "El p√°ramo es una p√°gina en blanco. Cada paso escribe una palabra que el viento borra. Pero el coraz√≥n recuerda las historias que el aire se lleva, porque est√°n hechas del mismo polvo que nos cre√≥.",
    a: "Voces del pueblo. Pedro P√°ramo"
  },
  {
    t: "Yo mat√© a Pedro P√°ramo. Fue como si hubiera destruido a mi propio padre, porque de √©l depend√≠a mi mundo. Pero tambi√©n fue como quitar una piedra del camino para que corriera el agua. Desde entonces oigo el murmullo de la vida que vuelve.",
    a: "Abundio Mart√≠nez. Pedro P√°ramo"
  },
  {
    t: "No vayas a pedirle nada. Ex√≠gele lo nuestro. Lo dem√°s es cosa tuya. Eso me dijo mi madre mientras me apretaba las manos antes de morir, y con esas palabras cargu√© el camino entero hasta Comala.",
    a: "Dolores Preciado. Pedro P√°ramo"
  },
  {
    t: "El pueblo estaba lleno de ecos. Cada vez que pronunciaba el nombre de Pedro P√°ramo, me contestaban murmullos que ven√≠an del suelo, como si la tierra misma lo repitiera.",
    a: "Juan Preciado. Pedro P√°ramo"
  },
  {
    t: "Sent√≠ que el aire ol√≠a a humedad envejecida, a tierra reci√©n abierta. Era un olor triste, como si de las paredes brotara la voz de los muertos que no terminan de irse.",
    a: "Susana San Juan. Pedro P√°ramo"
  },
  {
    t: "Yo estaba hecha para so√±ar, para caminar entre recuerdos. Por eso Pedro P√°ramo me buscaba: sab√≠a que mis pensamientos eran el √∫nico lugar donde todav√≠a pod√≠a encontrar consuelo.",
    a: "Susana San Juan. Pedro P√°ramo"
  },
  {
    t: "En la Media Luna todo ten√≠a due√±o, hasta el silencio. Y sin embargo, cuando √©l muri√≥, entendimos que el poder de Pedro P√°ramo era s√≥lo un polvo que se deshac√≠a en el aire caliente.",
    a: "Fulgor Sedano. Pedro P√°ramo"
  }
];

const storage = typeof window !== 'undefined' ? window.localStorage : undefined;
const quoteManager = createQuoteManager(QUOTES, storage);

let currentQuote = null;
const synth = typeof window !== 'undefined' && 'speechSynthesis' in window ? window.speechSynthesis : null;
let voicesReady = synth ? synth.getVoices().length > 0 : false;

// Selecciona la voz m√°s fluida disponible
function getPreferredVoice() {
  if (!synth) return null;
  const voices = synth.getVoices();
  return (
    voices.find(v => v.lang.startsWith("es") && v.name.includes("Google")) ||
    voices.find(v => v.lang.startsWith("es") && v.name.includes("Microsoft Sabina")) ||
    voices.find(v => v.lang.startsWith("es"))
  );
}

function speakQuote(text) {
  if (!synth) {
    return;
  }
  if (!voicesReady) {
    setTimeout(() => speakQuote(text), 200);
    return;
  }
  if (synth.speaking) {
    synth.cancel();
  }
  const utter = new window.SpeechSynthesisUtterance(text);
  const preferred = getPreferredVoice();
  if (preferred) {
    utter.voice = preferred;
    utter.lang = preferred.lang;
  } else {
    utter.lang = "es-ES";
  }
  synth.speak(utter);
}

function renderQuote() {
  currentQuote = quoteManager.next();
  document.getElementById('quote').textContent = '‚Äú' + currentQuote.t + '‚Äù';
  document.getElementById('author').textContent = '‚Äî ' + currentQuote.a;
}

function initApp() {
  renderQuote();
  const card = document.getElementById("card");
  if (card) {
    card.addEventListener("click", () => {
      if (currentQuote) {
        speakQuote(`${currentQuote.t}. ${currentQuote.a}`);
      }
    });
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        if (currentQuote) {
          speakQuote(`${currentQuote.t}. ${currentQuote.a}`);
        }
      }
    });
  }
}

// Espera a que las voces est√©n listas antes de permitir hablar
if (synth) {
  synth.onvoiceschanged = () => {
    voicesReady = true;
  };
}

document.addEventListener("DOMContentLoaded", () => {
  if (synth && synth.getVoices().length > 0) {
    voicesReady = true;
  }
  initApp();
});
